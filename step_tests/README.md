# 步骤测试模块

这个目录包含了从 `enhanced_recognition_start.py` 中提取的各个步骤功能的独立测试模块。每个模块都可以单独运行，用于测试和验证特定步骤的功能。

## 文件说明

### 步骤测试文件

1. **1_helper_functions.py** - 步骤1：辅助功能测试模块
   - 功能：各种辅助功能，如依赖检查、数据文件检查、清理等
   - 测试：V2.0优化功能测试

2. **2_step1_get_screenshots.py** - 步骤2：获取原始图片功能测试
   - 功能：检查和选择游戏截图
   - 测试：验证截图读取和检查功能

3. **3_step2_cut_screenshots.py** - 步骤3：分割原始图片功能测试
   - 功能：将游戏截图分割成单个装备图片
   - 测试：验证截图切割和标记功能

4. **4_step3_match_equipment.py** - 步骤4：装备识别匹配功能测试
   - 功能：使用基准装备对比切割后的图片
   - 测试：验证装备识别和匹配算法

5. **5_ocr_amount_recognition.py** - 步骤5：金额识别OCR模块测试
   - 功能：识别图片中的金额并保存结果
   - 测试：验证金额识别和OCR功能

6. **6_step4_integrate_results.py** - 步骤6：整合装备名称和金额识别结果功能测试
   - 功能：整合装备名称和金额识别结果到统一CSV文件
   - 测试：验证OCR识别和结果整合

7. **7_generate_annotated_screenshots.py** - 步骤7：生成带圆形标记的原图注释功能测试
   - 功能：在原始游戏截图上标注匹配的装备位置
   - 测试：验证注释生成和可视化功能

8. **8_visual_debugger.py** - 步骤8：可视化调试器功能测试
   - 功能：生成装备匹配的可视化调试报告
   - 测试：验证可视化调试和报告生成功能

### 主测试运行文件

9. **run_all_tests.py** - 主测试运行文件
   - 功能：统一管理和运行所有步骤的测试
   - 提供菜单界面，可以选择运行特定步骤的功能或测试
   - 已更新支持所有新增模块

## 使用方法

### 运行单个步骤测试

可以直接运行每个步骤的测试文件：

```bash
# 运行步骤1测试（辅助功能）
python step_tests/1_helper_functions.py

# 运行步骤2测试（获取原始图片）
python step_tests/2_step1_get_screenshots.py

# 运行步骤3测试（分割原始图片）
python step_tests/3_step2_cut_screenshots.py

# 运行步骤4测试（装备识别匹配）
python step_tests/4_step3_match_equipment.py

# 运行步骤5测试（金额识别OCR）
python step_tests/5_ocr_amount_recognition.py

# 运行步骤6测试（整合结果）
python step_tests/6_step4_integrate_results.py

# 运行步骤7测试（生成带圆形标记的原图注释）
python step_tests/7_generate_annotated_screenshots.py

# 运行步骤8测试（可视化调试器）
python step_tests/8_visual_debugger.py
```

### 使用主测试运行器

推荐使用主测试运行器，它提供了统一的界面来管理和运行所有测试：

```bash
python step_tests/run_all_tests.py
```

主测试运行器提供以下选项：

- **步骤功能**：运行特定步骤的实际功能
- **步骤测试**：运行特定步骤的测试功能
- **批量操作**：运行所有步骤测试或完整工作流程

注意：新的执行顺序已调整为：
1. 辅助功能（环境检查）
2. 获取原始图片
3. 分割原始图片
4. 装备识别匹配
5. 金额识别OCR
6. 整合结果
7. 生成带圆形标记的原图注释（可选）
8. 可视化调试器（可选）

## 测试内容

### 步骤1测试内容

1. 游戏截图目录检查
2. 测试截图创建
3. 截图文件格式验证
4. 截图读取功能
5. 文件数量统计

### 步骤2测试内容

1. 测试截图创建
2. 截图分析功能
3. 固定坐标切割
4. 圆形标记功能
5. 文件重命名功能

### 步骤3测试内容

1. 测试基准装备创建
2. 测试切割装备创建
3. 传统匹配器测试
4. 增强特征匹配器测试
5. 特征缓存功能测试
6. 匹配结果准确性验证

### 步骤4测试内容

1. 测试装备和标记文件创建
2. OCR识别功能测试
3. 结果整合功能测试
4. CSV输出格式验证
5. 文件重命名功能测试

### 辅助功能测试内容

1. 图像预处理流水线测试
2. 自动缓存更新器测试
3. 图像哈希工具测试
4. 质量检测器测试
5. 可视化调试器测试
6. 增强特征匹配器测试
7. ORB特征点优化测试

### 金额识别OCR测试内容

1. 金额测试图片创建
2. OCR识别功能测试
3. OCR配置管理测试
4. 金额格式化功能测试
5. CSV记录管理测试

## 注意事项

1. 所有测试文件都是独立的，包含了必要的依赖导入和错误处理
2. 测试过程中会创建临时目录和文件，测试结束后会自动清理
3. 如果某些模块不可用，测试会跳过相关功能并给出提示
4. 建议在运行测试前确保项目依赖已正确安装

## 故障排除

如果遇到导入错误，请确保：

1. 在项目根目录下运行测试
2. 所有必要的依赖已安装（运行 `pip install -r requirements.txt`）
3. `src` 目录存在且包含必要的模块文件

如果测试失败，请检查：

1. 相关目录是否存在且有正确的权限
2. 配置文件是否正确设置
3. 输入数据是否符合要求