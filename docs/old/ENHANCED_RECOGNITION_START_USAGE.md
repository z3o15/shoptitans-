# 增强版启动脚本使用指南

## 概述

`enhanced_recognition_start.py` 是一个整合了 `start.py` 和 `run_recognition_start.py` 功能的增强版启动脚本，新增了测试功能选项，提供了更完整的用户体验。

## 主要特性

1. **完整的工作流程**：支持四步工作流程（获取原始图片 → 分割图片 → 装备匹配 → 整合结果）
2. **多种运行模式**：支持交互式模式和全自动模式
3. **测试功能**：每个步骤都有对应的测试选项，可以验证功能是否正常
4. **高级功能**：支持特征缓存、增强匹配器、OCR识别等高级功能
5. **友好的用户界面**：清晰的菜单结构和提示信息

## 安装和设置

1. 确保 `enhanced_recognition_start.py` 文件位于项目根目录
2. 确保所有依赖模块已正确安装
3. 确保项目结构完整，包括：
   - `src/` 目录及其中的模块
   - `images/` 目录及其子目录
   - `tests/` 目录及其测试文件

## 使用方法

### 启动脚本

```bash
python enhanced_recognition_start.py
```

### 菜单选项

#### 工作流程选项

1. **步骤1：获取原始图片**
   - 检查游戏截图目录
   - 列出可用的截图文件
   - 验证截图格式和数量

2. **步骤2：分割原始图片**
   - 将游戏截图分割成单个装备图片
   - 支持圆形标记功能
   - 可选择保存原图或仅保存圆形区域

3. **步骤3：装备识别匹配**
   - 使用基准装备对比切割后的图片
   - 支持传统匹配器和增强特征匹配器
   - 可设置匹配阈值

4. **步骤4：整合装备名称和金额识别结果**
   - 整合装备名称和金额识别结果
   - 生成CSV格式的输出文件
   - 重命名匹配的文件

5. **运行完整工作流程（交互式）**
   - 依次执行四个步骤
   - 每步需要用户确认
   - 适合新手用户

6. **运行全自动工作流程（推荐）**
   - 自动执行所有步骤
   - 无需用户交互
   - 适合日常使用

#### 测试功能选项

7. **测试步骤1：获取原始图片功能**
   - 验证截图读取和检查功能
   - 创建临时测试数据
   - 测试完成后自动清理

8. **测试步骤2：分割图片功能**
   - 验证截图切割和标记功能
   - 测试固定坐标切割
   - 测试圆形标记和文件重命名

9. **测试步骤3：装备匹配功能**
   - 验证装备识别和匹配算法
   - 测试传统匹配器和增强匹配器
   - 测试特征缓存功能

10. **测试步骤4：整合结果功能**
    - 验证OCR识别和结果整合
    - 测试CSV输出格式
    - 测试文件重命名功能

11. **运行完整系统测试**
    - 执行完整的系统功能测试
    - 基于现有的 `test_system.py`

12. **运行特征缓存测试**
    - 测试特征缓存系统
    - 基于现有的 `test_feature_cache.py`

13. **运行性能测试**
    - 对比不同算法的性能
    - 测试缓存带来的性能提升

14. **运行MVP测试**
    - 快速验证核心功能
    - 基于现有的 `run_mvp_test.py`

#### 其他功能选项

15. **检查环境和依赖**
    - 检查Python依赖包
    - 检查数据文件和目录

16. **查看项目文档**
    - 打开README.md文档
    - 提供项目信息和使用说明

17. **清理切割结果和日志**
    - 清理切割后的装备文件
    - 清理旧的日志文件

18. **生成带圆形标记的原图注释**
    - 在原始游戏截图上标注匹配的装备位置
    - 生成注释报告

## 使用建议

### 新用户

1. 首次使用建议先运行测试功能，确保系统正常工作：
   - 选择选项7-10测试各个步骤
   - 选择选项11运行完整系统测试

2. 熟悉系统后，可以使用交互式工作流程：
   - 选择选项5运行完整工作流程
   - 按照提示一步步操作

3. 日常使用推荐全自动工作流程：
   - 选择选项6运行全自动工作流程
   - 无需手动干预

### 开发者

1. 开发新功能时，可以使用测试功能验证：
   - 选择特定步骤的测试选项
   - 运行性能测试比较算法效率

2. 调试问题时：
   - 使用测试功能定位问题
   - 查看详细的测试报告和错误信息

### 高级用户

1. 可以直接运行特定步骤：
   - 选择选项1-4执行特定步骤
   - 根据需要调整参数

2. 使用高级功能：
   - 确保配置文件中启用了特征缓存
   - 使用增强匹配器提高识别准确率

## 配置说明

### 基本配置

配置文件位于 `config/config.json`，包含以下主要配置：

1. **切割参数**：
   - `grid`: 网格行列数
   - `item_width`: 装备宽度
   - `item_height`: 装备高度
   - `margin_left`: 左边距
   - `margin_top`: 上边距

2. **匹配参数**：
   - `default_threshold`: 默认匹配阈值
   - `min_match_count`: 最小匹配点数
   - `match_ratio_threshold`: 匹配比例阈值

3. **特征缓存配置**：
   - `enabled`: 是否启用特征缓存
   - `cache_dir`: 缓存目录
   - `target_size`: 目标图像尺寸
   - `nfeatures`: 特征点数量

### 高级配置

1. **OCR配置**：
   - OCR识别参数
   - 文本预处理选项

2. **日志配置**：
   - 日志级别
   - 输出格式

## 故障排除

### 常见问题

1. **导入错误**：
   - 确保所有依赖模块已安装
   - 检查Python路径设置

2. **文件权限错误**：
   - 确保对项目目录有写权限
   - 检查images目录是否可写

3. **匹配结果不准确**：
   - 尝试降低匹配阈值
   - 检查基准装备图片质量
   - 启用特征缓存提高准确性

4. **OCR识别失败**：
   - 检查marker目录中的图片质量
   - 调整OCR参数
   - 确保图片中的数字清晰可见

### 调试方法

1. 使用测试功能定位问题：
   - 运行特定步骤的测试
   - 查看详细的测试报告

2. 检查日志文件：
   - 查看 `recognition_logs/` 目录中的日志
   - 根据错误信息定位问题

3. 使用调试模式：
   - 修改配置文件启用调试输出
   - 重新运行功能查看详细信息

## 性能优化

1. **启用特征缓存**：
   - 在配置文件中启用特征缓存
   - 首次运行会构建缓存，后续运行会更快

2. **调整匹配参数**：
   - 根据实际情况调整匹配阈值
   - 平衡准确率和性能

3. **优化图片处理**：
   - 使用适当的图片格式
   - 调整图片大小和质量

## 扩展功能

1. **添加新的测试用例**：
   - 在相应的测试函数中添加测试逻辑
   - 确保测试数据正确清理

2. **集成新的算法**：
   - 在相应的步骤函数中添加新算法
   - 更新配置文件支持新参数

3. **添加新的菜单选项**：
   - 在 `show_menu()` 函数中添加新选项
   - 在 `main()` 函数中添加对应的处理逻辑

## 版本历史

- v1.0: 初始版本，整合start.py和run_recognition_start.py的功能
- v1.1: 添加测试功能选项
- v1.2: 优化用户界面和错误处理
- v1.3: 添加性能测试和高级配置选项

## 贡献指南

1. 提交代码前确保所有测试通过
2. 添加新功能时同时添加相应的测试
3. 更新文档说明新功能的使用方法
4. 遵循现有的代码风格和命名规范

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交Issue到项目仓库
- 发送邮件到项目维护者
- 参与项目讨论区