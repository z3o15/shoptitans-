# 自动化装备处理系统使用说明

## 🎯 系统概述

自动化装备处理系统实现了从游戏截图到最终表格输出的完全自动化处理，包含以下四个核心步骤：

1. **环境检查** - 验证依赖和配置
2. **截图裁剪** - 从游戏截图中提取装备图标
3. **装备匹配** - 使用LAB色彩空间进行装备识别匹配
4. **OCR识别** - 识别装备金额信息并生成表格

## 🚀 启动方式

### 方式一：双击批处理文件（推荐）
直接双击 `启动自动化处理.bat` 文件即可启动完整的自动化处理流程。

### 方式二：命令行启动
```bash
# 运行完整流程
python auto_equipment_processor.py

# 执行特定步骤
python auto_equipment_processor.py --step 1  # 环境检查
python auto_equipment_processor.py --step 2  # 截图裁剪
python auto_equipment_processor.py --step 3  # 装备匹配
python auto_equipment_processor.py --step 4  # OCR识别

# 清理后执行完整流程
python auto_equipment_processor.py --clean

# 使用自定义配置
python auto_equipment_processor.py --config custom_config.json
```

## 📁 目录结构要求

确保以下目录存在并包含相应文件：

```
images/
├── game_screenshots/          # 游戏截图文件 (.png, .jpg, .jpeg)
└── base_equipment/           # 基准装备图片

输出目录 (自动创建):
├── equipment_crop/           # 裁剪的矩形装备图
├── equipment_transparent/    # 圆形透明装备图
├── output/                  # 输出目录
│   ├── ocr/                 # OCR结果和CSV文件
│   └── matching/            # 装备匹配输出
└── recognition_logs/        # 日志文件
```

## 📋 处理流程详解

### 步骤1：环境检查
- 验证Python依赖包 (cv2, PIL, numpy)
- 检查必要目录结构
- 验证配置文件

### 步骤2：截图裁剪
- 从游戏截图中按网格切割装备图标
- 生成矩形装备图到 `images/equipment_crop/`
- 生成圆形透明图到 `images/equipment_transparent/`

### 步骤3：装备匹配
- 使用LAB色彩空间进行模板匹配
- 像素级颜色相似度计算
- 生成CSV匹配结果和对比图

### 步骤4：OCR识别
- 对装备图片进行OCR文字识别
- 提取金额信息
- 生成处理报告和表格

## 📊 输出结果

处理完成后，将在以下位置生成结果文件：

- `output/ocr/` - CSV表格文件和处理报告
- `output/ocr/auto_processing_report_*.txt` - 详细的处理报告
- `output/ocr/*.csv` - 数据表格文件

## ⚙️ 配置说明

系统使用 `config.json` 文件进行配置，主要参数：

```json
{
  "cutting": {
    "grid_cols": 6,        // 裁剪网格列数
    "grid_rows": 4         // 裁剪网格行数
  },
  "matching": {
    "similarity_threshold": 0.7  // 匹配相似度阈值
  },
  "ocr": {
    "min_confidence": 0.8        // OCR最小置信度
  }
}
```

## 🔧 故障排除

### 常见问题

**Q: 提示"未检测到Python"**
- 确保已安装Python 3.7+
- 下载地址: https://www.python.org/downloads/

**Q: 依赖包缺失**
```bash
pip install opencv-python pillow numpy
```

**Q: 找不到游戏截图文件**
- 检查 `images/game_screenshots/` 目录
- 确保文件格式为 .png, .jpg 或 .jpeg

**Q: 装备匹配结果不准确**
- 调整 `config.json` 中的 `similarity_threshold`
- 检查基准装备图片质量
- 确保游戏截图清晰

**Q: OCR识别失败**
- 确保装备图片中的文字清晰
- 调整OCR配置参数
- 检查图片分辨率和对比度

### 日志查看

详细日志保存在：
- `recognition_logs/` - 详细的处理日志
- `output/ocr/auto_processing_report_*.txt` - 自动生成的处理报告

## 📝 使用技巧

1. **批量处理** - 可以一次性放入多个游戏截图文件
2. **中断恢复** - 处理过程可以随时中断，已处理的文件会保留
3. **增量处理** - 重复运行时会跳过已处理的文件
4. **自定义配置** - 可以根据实际需求调整匹配阈值和OCR参数

## 🔍 性能优化

- 使用SSD硬盘提升IO性能
- 确保足够的内存空间（建议8GB+）
- 多核CPU可以加速处理过程

## 📞 技术支持

如遇到问题，请检查：
1. Python和依赖包版本
2. 输入文件格式和路径
3. 配置文件参数设置
4. 系统日志文件

---

*最后更新: 2025-11-26*