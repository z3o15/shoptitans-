# 2_cut.py - 截图切割工具

## 功能概述

从游戏截图中自动识别并切割装备图标，生成两种格式的图像：
1. **矩形装备图** - 保存到 `output_enter_image/equipment_crop/`
2. **圆形透明图** - 保存到 `output_enter_image/equipment_transparent/`

这是自动化装备处理流程的第2步，将完整的游戏截图分解为单个装备图标。

## 核心功能

### 图像处理流程
1. **自动检测截图** - 扫描游戏截图目录
2. **装备图标识别** - 在截图中定位装备位置
3. **网格切割** - 按预设网格尺寸切割装备图标
4. **格式转换** - 生成矩形和圆形两种格式
5. **透明背景处理** - 为圆形图标创建透明背景

### 输出格式
- **矩形图**: 原始装备图标，包含背景
- **圆形透明图**: 装备图标裁剪为圆形，背景透明

## 命令行参数

### 基本用法
```bash
python step_tests/2_cut.py
```

### 参数说明
- `--test`: 运行测试模式，用于验证切割功能
  - 类型: 标志参数
  - 默认: 不启用
  - 用法: `python step_tests/2_cut.py --test`

## 输入要求

### 截图目录
- **路径**: `output_enter_image/game_screenshots/`
- **格式要求**:
  - 支持的格式: `.png`, `.jpg`, `.jpeg`, `.webp`
  - 截图应包含完整的装备界面
- **文件组织**: 可以包含多个截图文件

### 截图内容要求
- 截图应显示完整的装备网格界面
- 装备图标应排列整齐，便于自动识别
- 建议使用高清截图以获得更好的识别效果

## 输出结果

### 输出目录结构
```
output_enter_image/
├── equipment_crop/          # 矩形装备图
│   ├── 01.png
│   ├── 02.png
│   └── ...
└── equipment_transparent/   # 圆形透明图
    ├── 01_circle.png
    ├── 02_circle.png
    └── ...
```

### 文件命名规则
- **矩形图**: 按数字顺序命名（01.png, 02.png, ...）
- **圆形透明图**: 在矩形图名称后添加 `_circle` 后缀

### 输出质量
- **分辨率**: 保持原始截图的分辨率
- **格式**: PNG格式（支持透明背景）
- **质量**: 无损压缩

## 使用场景

### 标准工作流程
1. **准备截图**: 将游戏截图放入 `output_enter_image/game_screenshots/`
2. **运行切割**: `python step_tests/2_cut.py`
3. **检查结果**: 查看输出目录中的装备图标
4. **后续处理**: 使用切割后的图标进行装备匹配

### 测试模式
```bash
python step_tests/2_cut.py --test
```
- 用于验证切割功能是否正常
- 使用示例数据进行测试
- 不会影响实际的生产数据

## 技术特性

### 图像处理算法
- **边缘检测**: 自动识别装备图标边界
- **网格分析**: 分析装备在截图中的排列规律
- **形状识别**: 区分装备图标和背景区域

### 性能优化
- **批量处理**: 一次性处理多个截图
- **内存管理**: 大文件分块处理，避免内存溢出
- **错误恢复**: 单个文件出错不影响整体处理

### 兼容性
- **多格式支持**: 支持常见的图像格式
- **中文路径**: 完全支持包含中文字符的路径
- **跨平台**: 支持Windows、Linux、macOS

## 配置参数

### 内部配置（代码中定义）
- **网格尺寸**: 可根据游戏界面调整装备网格的行数和列数
- **切割精度**: 控制装备图标识别的精确度
- **输出质量**: 图像质量和文件大小的平衡

## 故障排除

### 常见问题

#### Q: 提示"未找到截图"
**A**: 检查以下内容：
- 确保 `output_enter_image/game_screenshots/` 目录存在
- 确认目录中有图像文件
- 检查文件格式是否为支持的格式（.png, .jpg, .jpeg, .webp）

#### Q: 切割结果不正确
**A**: 可能的原因：
- 截图分辨率过低
- 截图中的装备界面不完整
- 游戏界面缩放比例异常
**解决方法**:
- 使用高清截图
- 确保截图包含完整的装备网格
- 检查游戏显示设置

#### Q: 圆形透明图效果不好
**A**: 可能的原因：
- 装备图标边界识别不准确
- 背景颜色与装备颜色相近
**解决方法**:
- 调整图像对比度
- 使用更高清的截图
- 检查游戏界面设置

#### Q: 处理速度慢
**A**: 优化建议：
- 减少同时处理的截图数量
- 使用分辨率适中的截图
- 关闭其他占用内存的程序

### 错误代码含义
- **路径错误**: 输入或输出目录无法访问
- **格式错误**: 截图文件格式不支持
- **处理错误**: 图像处理过程中出现异常
- **权限错误**: 没有写入输出目录的权限

## 性能指标

### 处理能力
- **单张截图**: 通常在1-5秒内完成处理
- **批量处理**: 支持同时处理多张截图
- **内存使用**: 优化了内存占用，支持大文件处理

### 输出质量
- **精度**: 像素级精确切割
- **一致性**: 不同截图间保持一致的切割标准
- **完整性**: 确保所有装备图标都被正确识别和切割

## 注意事项

1. **首次使用前**，建议使用 `--test` 参数验证功能
2. **处理大量截图时**，注意磁盘空间是否充足
3. **重要数据**，请在处理前进行备份
4. **定期清理** 输出目录中的旧文件，避免混淆
5. **保持截图的一致性**，使用相同的游戏设置和分辨率

## 更新日志

### 当前版本特性
- 支持圆形透明图生成
- 优化了装备图标识别算法
- 改进了中文路径支持
- 添加了测试模式功能
- 移除了时间戳目录结构，使用扁平输出