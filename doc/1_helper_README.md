# 1_helper.py - 辅助功能测试模块

## 功能概述

提供基础的环境检查、依赖验证和数据文件确认功能。这是项目的基础诊断工具，确保运行环境和数据文件都准备就绪。

## 主要功能

### 1. 环境和依赖检查
- **功能**: 检查Python依赖包是否已正确安装
- **检查的包**:
  - `cv2` (OpenCV) - 图像处理
  - `PIL` (Pillow) - 图像处理
  - `numpy` - 数值计算
- **自动安装**: 如果发现缺少依赖，会尝试自动从 `requirements.txt` 安装

### 2. 数据文件检查
- **功能**: 验证项目必需的数据目录和文件是否存在
- **检查内容**:
  - 基准装备图像目录
  - 游戏截图目录
  - 其他必要的项目文件

### 3. 清理旧文件
- **功能**: 清理之前运行产生的临时文件和输出文件
- **清理范围**:
  - 输出目录中的旧文件
  - 临时缓存文件
  - 日志文件

### 4. 基础功能测试
- **功能**: 测试核心图像处理功能是否正常
- **测试项目**:
  - 图像读取和写入
  - 基础图像处理操作
  - 文件操作权限

## 使用方法

### 交互式菜单
```bash
python step_tests/1_helper.py
```

运行后会显示交互式菜单：
```
辅助功能测试模块
1. 检查环境和依赖
2. 检查数据文件
3. 清理旧文件
4. 测试基础功能
0. 退出

请选择操作 (0-4):
```

### 菜单选项说明

#### 1. 检查环境和依赖
- **作用**: 验证所有必需的Python包是否已安装
- **输出**:
  - ✓ 如果包已安装
  - ✗ 如果包缺失
  - 自动尝试安装缺失的包
- **建议**: 首次使用项目前运行此检查

#### 2. 检查数据文件
- **作用**: 确认项目所需的目录结构是否完整
- **检查目录**:
  - `output_enter_image/base_equipment/` - 基准装备图像
  - `output_enter_image/game_screenshots/` - 游戏截图
  - 其他必要目录
- **输出**: 显示每个目录的状态

#### 3. 清理旧文件
- **作用**: 清理之前运行的输出文件
- **清理目标**:
  - `output/` 目录下的所有文件
  - `output_enter_image/` 中的临时文件
- **安全性**: 只清理程序生成的文件，不会删除源数据

#### 4. 测试基础功能
- **作用**: 验证核心功能是否正常工作
- **测试内容**:
  - 图像文件读取测试
  - 基础图像处理测试
  - 文件写入权限测试
- **输出**: 显示每个测试的通过/失败状态

## 退出选项

选择 `0` 可以安全退出程序。

## 常见问题

### Q: 提示"缺少依赖包"怎么办？
A: 选择选项1，程序会自动尝试安装。如果自动安装失败，请手动运行：
```bash
pip install -r requirements.txt
```

### Q: 数据文件检查失败怎么办？
A: 确保以下目录存在并包含相应文件：
- `output_enter_image/base_equipment/` - 需要包含基准装备图片
- `output_enter_image/game_screenshots/` - 需要包含游戏截图

### Q: 什么情况下需要清理旧文件？
A: 在以下情况下建议清理：
- 重新开始处理流程
- 输出文件出现异常
- 磁盘空间不足
- 更新了处理逻辑后

### Q: 基础功能测试失败怎么办？
A: 可能的原因：
- Python环境问题
- 权限不足
- 依赖包版本不兼容
建议重新安装依赖包或检查Python环境

## 技术细节

### 导入的模块
- `os`, `sys` - 系统操作
- `subprocess` - 子进程调用
- `unified_logger` - 统一日志系统（可选）

### 错误处理
- 优雅处理 `KeyboardInterrupt` (Ctrl+C)
- 捕获并记录依赖安装错误
- 提供详细的错误信息和建议

### 兼容性
- 支持Python 3.8+
- 兼容Windows和Linux系统
- 自动处理中文路径问题